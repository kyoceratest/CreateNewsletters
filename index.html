<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Newsletter - KYOCERA Document Solutions</title>
        <link rel="stylesheet" href="styles.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link rel="icon" type="image/png" href="Image/header_footer/logo.png" />
        <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    </head>
<body class="newsletter-editor">
    <header class="kyocera-header">
        <div class="header-top desktop-header">
            <div class="header-logo">
                <a href="https://www.kyoceradocumentsolutions.fr/fr.html">
                    <img src="Image/header_footer/logo.png"  />
                </a>
                <span class="header-logo-text">KYOCERA Document Solutions</span>
            </div>
            <div class="header-lang-account">
                <a href="https://www.kyoceradocumentsolutions.fr/fr/about-us/contact-us/kyocera-worldwide.html" class="lang-text">
                    <img src="Image/header_footer/fr.svg" alt="France" class="flag-icon" />
                    FR France
                </a>
                <a href="https://mykyocera.kyoceradocumentsolutions.fr/fr.html" class="account-text">My Kyocera</a>
            </div>
        </div>
        <div class="mobile-header">
            <div class="mobile-header-top">
                <div class="header-logo">
                    <a href="https://www.kyoceradocumentsolutions.fr/fr.html">
                        <img src="Image/header_footer/logo.png"  />
                    </a>
                    <span class="header-logo-text">KYOCERA Document Solutions</span>
                </div>
        </div>
            <div class="mobile-header-bottom">
                <a href="https://www.kyoceradocumentsolutions.fr/fr/about-us/contact-us/kyocera-worldwide.html" class="mobile-lang-text">
                    <i class="fas fa-globe"></i>
                    FR / France
                        </a>
                <div class="mobile-icons-group">
                    <a href="https://mykyocera.kyoceradocumentsolutions.fr/fr.html">
                        <img src="Image/header_footer/mykyocer.svg" alt="My Kyocera" class="mobile-user-icon">
                    </a>
                    <button class="hamburger sidebar-hamburger" id="sidebarHamburger">
                        <span></span>
                        <span></span>
                        <span></span>
            </button>
                </div>
            </div>
        </div>
    </header>

    <div class="main-content-wrapper" style="display: flex; flex: 1; position: relative; overflow: hidden; height: calc(100vh - 60px);">
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="editor-sidebar">
        <div class="tool-section">
            <h3>Outils</h3>
            <div class="tool-group">
                <button class="tool-btn" id="insertImageBtn">
                    <i class="fas fa-image"></i> Insérer Image
                </button>
                <div class="image-options" id="imageOptions" style="display: none;">
                    <button class="option-btn" id="localImageBtn">Image locale</button>
                    <button class="option-btn" id="urlImageBtn">Image URL</button>
                    <button class="option-btn" id="resizeFolderUnderInsertBtn">Redimensionner dossier</button>
                </div>
            </div>
            <div class="tool-group">
                <button class="tool-btn" id="insertVideoBtn">
                    <i class="fas fa-video"></i> Insérer Vidéo
                </button>
                <div class="video-options" id="videoOptions" style="display: none;">
                    <button class="option-btn" id="urlVideoBtn">
                        <i class="fas fa-link"></i> Vidéo URL
                </button>
                    <button class="option-btn" id="localVideoBtn">
                        <i class="fas fa-file-video"></i> Vidéo locale
                </button>
                    <button class="option-btn" id="standardizeVideosBtn">
                        <i class="fas fa-magic"></i> Standardiser
                    </button>
        </div>
            </div>
            <div class="tool-group">
                <button class="tool-btn" id="insertSectionBtn">
                    <i class="fas fa-th-large"></i> Insérer Section
                    </button>
                <div class="section-options" id="sectionOptions" style="display: none;">
                    <button class="option-btn" id="twoColumnSectionBtn">
                        <i class="fas fa-columns"></i> Deux colonnes
                    </button>
                    <button class="option-btn" id="articleSectionBtn">
                        <i class="fas fa-newspaper"></i> Article
                        </button>
                    <button class="option-btn" id="gallerySectionBtn">
                        <i class="fas fa-images"></i> Galerie
                        </button>
                    <button class="option-btn" id="multiImagesSectionBtn">
                        <i class="fas fa-images"></i> Multi images
                        </button>
                    <button class="option-btn" id="quoteSectionBtn">
                        <i class="fas fa-quote-left"></i> Promotion
                        </button>
                    <button class="option-btn" id="ctaSectionBtn">
                        <i class="fas fa-bullhorn"></i> Annonce
                        </button>
                    <button class="option-btn" id="contactSectionBtn">
                        <i class="fas fa-address-card"></i> Contact
                    </button>
                </div>
            </div>
            <div class="tool-group">
                <button class="tool-btn" id="importBtn">
                    <i class="fas fa-file-import"></i> Importer
                </button>
                <div class="import-options" id="importOptions" style="display: none;">
                    <button class="option-btn" id="importHtmlBtn"><i class="fas fa-code"></i> HTML</button>
                    <button class="option-btn" id="importExcelBtn"><i class="fas fa-file-pdf"></i> PDF</button>
                </div>
            </div>
            <div class="tool-group">
                <button class="tool-btn action-btn" id="undoBtn">
                    <i class="fas fa-undo"></i> Annuler
                    </button>
                <button class="tool-btn action-btn" id="refreshBtn">
                    <i class="fas fa-redo"></i> Répéter
                        </button>
                <button class="tool-btn action-btn" id="clearBtn">
                    <i class="fas fa-trash"></i> Nettoyer
                        </button>
                    </div>
            <div class="tool-group">
                <button class="tool-btn save-btn" id="saveBtn">
                    <i class="fas fa-save"></i> Enregistrer
                </button>
                <button class="tool-btn" id="historyBtn">
                    <i class="fas fa-history"></i> Historique
                </button>
            </div>
        </div>
    </div>

    <!-- Main editable area (must be sibling of editor-sidebar inside main-content-wrapper) -->
    <main class="main-content">
      <div class="content-wrapper" style="position: relative; height: 100%;">
        <div class="content-area">
          <div class="editable-content" id="editableContent" contenteditable="true" spellcheck="false" style="height: 100%; overflow-y: auto;"></div>
        </div>
      </div>
    </main>

    <div class="rich-text-toolbar" id="richTextToolbar" style="display: none;">
        <div class="toolbar-section">
            <select id="fontFamily" class="toolbar-select">
                <option value="Verdana">Verdana</option>
            </select>
            <select id="fontSize" class="toolbar-select">
                <option value="" selected>Taille</option>
                <option value="52">Titre_P</option>
                <option value="22">Sous_titre _P</option>
               <option value="48">Titre_C</option>
               <option value="36">Sous_titre_C</option>
               <option value="26">Texte_C</option>
            </select>
            <select id="lineHeight" class="toolbar-select" title="Interligne">
                <option value="">Interligne</option>
                <option value="1.0">1.0</option>
                <option value="1.5">1.5</option>
                <option value="2.0">2.0</option>
            </select>
    </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-section">
            <button class="toolbar-btn" id="boldBtn" title="Gras"><i class="fas fa-bold"></i></button>
            <button class="toolbar-btn" id="italicBtn" title="Italique"><i class="fas fa-italic"></i></button>
            <button class="toolbar-btn" id="underlineBtn" title="Souligné"><i class="fas fa-underline"></i></button>
            <button class="toolbar-btn" id="strikeBtn" title="Barré"><i class="fas fa-strikethrough"></i></button>
                    </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-section">
            <div class="dropdown">
                <button class="toolbar-btn" id="textColorDropdownBtn" title="Couleur du texte">
                    <i class="fas fa-font" style="color: black;"></i>
                </button>
                <div class="dropdown-content color-dropdown" id="textColorDropdownContent" style="display: none;">
                    <div class="palette-heading">Couleurs principales</div>
                    <div class="color-palette primary" id="textColorPrimaryPalette">
                        <div class="palette-color" style="background-color: #000000;" data-color="#000000"></div>
                        <div class="palette-color" style="background-color: #FFFFFF;" data-color="#FFFFFF"></div>
                        <div class="palette-color" style="background-color: #6E3CBE;" data-color="#6E3CBE"></div>
                        <div class="palette-color" style="background-color: #0A9BCD;" data-color="#0A9BCD"></div>
                        <div class="palette-color" style="background-color: #F5B400;" data-color="#F5B400"></div>
                        <div class="palette-color" style="background-color: #F06400;" data-color="#F06400"></div>
                        <div class="palette-color" style="background-color: #00B176;" data-color="#00B176"></div>
                    </div>
                    <div class="palette-heading">Couleurs du thème</div>
                    <div class="color-palette" id="textColorPalette">
                        <div class="palette-color" style="background-color: #585858;" data-color="#585858"></div>
                        <div class="palette-color" style="background-color: #7E7E7E;" data-color="#7E7E7E"></div>
                        <div class="palette-color" style="background-color: #A9A9A9;" data-color="#A9A9A9"></div>
                        <div class="palette-color" style="background-color: #D4D4D4;" data-color="#D4D4D4"></div>
                        <div class="palette-color" style="background-color: #925ED2;" data-color="#925ED2"></div>
                        <div class="palette-color" style="background-color: #AE87DE;" data-color="#AE87DE"></div>
                        <div class="palette-color" style="background-color: #C9AFE9;" data-color="#C9AFE9"></div>
                        <div class="palette-color" style="background-color: #E4D7F4;" data-color="#E4D7F4"></div>
                        <div class="palette-color" style="background-color: #00B1DB;" data-color="#00B1DB"></div>
                        <div class="palette-color" style="background-color: #4AC5E5;" data-color="#4AC5E5"></div>
                        <div class="palette-color" style="background-color: #8DD9EE;" data-color="#8DD9EE"></div>
                        <div class="palette-color" style="background-color: #C7ECF6;" data-color="#C7ECF6"></div>
                        <div class="palette-color" style="background-color: #FFC200;" data-color="#FFC200"></div>
                        <div class="palette-color" style="background-color: #FFD14E;" data-color="#FFD14E"></div>
                        <div class="palette-color" style="background-color: #FFE18E;" data-color="#FFE18E"></div>
                        <div class="palette-color" style="background-color: #FFF0C8;" data-color="#FFF0C8"></div>
                        <div class="palette-color" style="background-color: #FF7C03;" data-color="#FF7C03"></div>
                        <div class="palette-color" style="background-color: #FF9E59;" data-color="#FF9E59"></div>
                        <div class="palette-color" style="background-color: #FFBF92;" data-color="#FFBF92"></div>
                        <div class="palette-color" style="background-color: #FFDFC9;" data-color="#FFDFC9"></div>
                        <div class="palette-color" style="background-color: #00C58D;" data-color="#00C58D"></div>
                        <div class="palette-color" style="background-color: #2FD3AB;" data-color="#2FD3AB"></div>
                        <div class="palette-color" style="background-color: #84E3C7;" data-color="#84E3C7"></div>
                        <div class="palette-color" style="background-color: #C4F0E3;" data-color="#C4F0E3"></div>
                    </div>
                </div>
            </div>
            <div class="dropdown">
                <button class="toolbar-btn" id="bgColorDropdownBtn" title="Couleur de fond">
                    <i class="fas fa-fill-drip" style="background-color: yellow;"></i>
                </button>
                <div class="dropdown-content color-dropdown" id="bgColorDropdownContent" style="display: none;">
                    <div class="palette-heading">Couleurs principales</div>
                    <div class="color-palette primary" id="bgColorPrimaryPalette">
                        <div class="palette-color" style="background-color: #000000;" data-color="#000000"></div>
                        <div class="palette-color" style="background-color: #FFFFFF;" data-color="#FFFFFF"></div>
                        <div class="palette-color" style="background-color: #6E3CBE;" data-color="#6E3CBE"></div>
                        <div class="palette-color" style="background-color: #0A9BCD;" data-color="#0A9BCD"></div>
                        <div class="palette-color" style="background-color: #F5B400;" data-color="#F5B400"></div>
                        <div class="palette-color" style="background-color: #F06400;" data-color="#F06400"></div>
                        <div class="palette-color" style="background-color: #00B176;" data-color="#00B176"></div>
                    </div>
                    <div class="palette-heading">Couleurs du thème</div>
                    <div class="color-palette" id="bgColorPalette">
                        <div class="palette-color" style="background-color: #585858;" data-color="#585858"></div>
                        <div class="palette-color" style="background-color: #7E7E7E;" data-color="#7E7E7E"></div>
                        <div class="palette-color" style="background-color: #A9A9A9;" data-color="#A9A9A9"></div>
                        <div class="palette-color" style="background-color: #D4D4D4;" data-color="#D4D4D4"></div>
                        <div class="palette-color" style="background-color: #925ED2;" data-color="#925ED2"></div>
                        <div class="palette-color" style="background-color: #AE87DE;" data-color="#AE87DE"></div>
                        <div class="palette-color" style="background-color: #C9AFE9;" data-color="#C9AFE9"></div>
                        <div class="palette-color" style="background-color: #E4D7F4;" data-color="#E4D7F4"></div>
                        <div class="palette-color" style="background-color: #00B1DB;" data-color="#00B1DB"></div>
                        <div class="palette-color" style="background-color: #4AC5E5;" data-color="#4AC5E5"></div>
                        <div class="palette-color" style="background-color: #8DD9EE;" data-color="#8DD9EE"></div>
                        <div class="palette-color" style="background-color: #C7ECF6;" data-color="#C7ECF6"></div>
                        <div class="palette-color" style="background-color: #FFC200;" data-color="#FFC200"></div>
                        <div class="palette-color" style="background-color: #FFD14E;" data-color="#FFD14E"></div>
                        <div class="palette-color" style="background-color: #FFE18E;" data-color="#FFE18E"></div>
                        <div class="palette-color" style="background-color: #FFF0C8;" data-color="#FFF0C8"></div>
                        <div class="palette-color" style="background-color: #FF7C03;" data-color="#FF7C03"></div>
                        <div class="palette-color" style="background-color: #FF9E59;" data-color="#FF9E59"></div>
                        <div class="palette-color" style="background-color: #FFBF92;" data-color="#FFBF92"></div>
                        <div class="palette-color" style="background-color: #FFDFC9;" data-color="#FFDFC9"></div>
                        <div class="palette-color" style="background-color: #00C58D;" data-color="#00C58D"></div>
                        <div class="palette-color" style="background-color: #2FD3AB;" data-color="#2FD3AB"></div>
                        <div class="palette-color" style="background-color: #84E3C7;" data-color="#84E3C7"></div>
                        <div class="palette-color" style="background-color: #C4F0E3;" data-color="#C4F0E3"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-section">
            <button class="toolbar-btn" id="alignLeftBtn" title="Aligner à gauche"><i class="fas fa-align-left"></i></button>
            <button class="toolbar-btn" id="alignCenterBtn" title="Centrer"><i class="fas fa-align-center"></i></button>
            <button class="toolbar-btn" id="alignRightBtn" title="Aligner à droite"><i class="fas fa-align-right"></i></button>
            <button class="toolbar-btn" id="alignJustifyBtn" title="Justifier"><i class="fas fa-align-justify"></i></button>
                    </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-section">
            <button class="toolbar-btn" id="bulletListBtn" title="Liste à puces"><i class="fas fa-list-ul"></i></button>
            <button class="toolbar-btn" id="numberListBtn" title="Liste numérotée"><i class="fas fa-list-ol"></i></button>
            <button class="toolbar-btn" id="indentBtn" title="Augmenter le retrait"><i class="fas fa-indent"></i></button>
            <button class="toolbar-btn" id="outdentBtn" title="Diminuer le retrait"><i class="fas fa-outdent"></i></button>
                        </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-section">
            <button class="toolbar-btn" id="linkBtn" title="Insérer lien"><i class="fas fa-link"></i></button>
            <button class="toolbar-btn" id="removeFormatBtn" title="Supprimer la mise en forme"><i class="fas fa-remove-format"></i></button>
                    </div>
                </div>
    
    <div class="image-toolbar" id="imageToolbar" style="display: none;">
        <div class="image-tools">
            <div class="image-tools-row">
            <div class="toolbar-divider"></div>
            <div class="toolbar-section">
                <div class="dropdown">
                    <button class="image-tool dropdown-btn" id="rotationBtn">
                        <i class="fas fa-sync"></i> Rotation <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="dropdown-content" id="rotationOptions" style="display: none;">
                        <button class="dropdown-item" id="rotateRight90Btn">
                            <i class="fas fa-redo"></i> Faire pivoter à droite de 90°
                        </button>
                        <button class="dropdown-item" id="rotateLeft90Btn">
                            <i class="fas fa-undo"></i> Faire pivoter à gauche de 90°
                        </button>
                        <button class="dropdown-item" id="flipVerticalBtn">
                            <i class="fas fa-arrows-alt-v"></i> Retourner verticalement
                        </button>
                        <button class="dropdown-item" id="flipHorizontalBtn">
                            <i class="fas fa-arrows-alt-h"></i> Retourner horizontalement
                        </button>
            </div>
        </div>
            </div>
            <div class="toolbar-divider"></div>
            <div class="toolbar-section">
                <button class="image-tool" id="cropImageBtn"><i class="fas fa-crop"></i> Recadrer</button>
                <button class="image-tool" id="cancelCropBtn" style="display: none;"><i class="fas fa-times"></i> Annuler</button>
                <button class="image-tool" id="applyCropBtn" style="display: none;"><i class="fas fa-check"></i> Appliquer</button>
        </div>
            <div class="toolbar-divider"></div>
            <div class="toolbar-section">
                <button class="image-tool" id="changeImageBtn"><i class="fas fa-image"></i> Changer l'image</button>
                <button class="image-tool" id="linkImageBtn"><i class="fas fa-link"></i> Lien</button>
            </div>
            <div class="toolbar-divider"></div>
            <div class="toolbar-section">
                <div class="dropdown">
                    <button class="image-tool dropdown-btn" id="positionBtn">
                        <i class="fas fa-arrows-alt"></i> Position <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="dropdown-content" id="positionOptions" style="display: none;">
                        <button class="dropdown-item" id="floatLeftBtn">
                            <i class="fas fa-align-left"></i> Flotter à gauche
                        </button>
                        <button class="dropdown-item" id="floatRightBtn">
                            <i class="fas fa-align-right"></i> Flotter à droite
                        </button>
                        <button class="dropdown-item" id="inlineBtn">
                            <i class="fas fa-align-center"></i> Centrer
                        </button>
                    </div>
                </div>
            </div>
            <div class="toolbar-divider"></div>
            <div class="toolbar-section">
                <div class="dropdown">
                    <button class="image-tool dropdown-btn" id="gapAdvancedBtn" title="Espacement personnalisé">
                        <i class="fas fa-ruler-combined"></i> <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="dropdown-content" id="gapAdvancedOptions" style="display: none; padding:10px; min-width:220px;">
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; align-items:center;">
                            <label for="gapTopInput" style="font-size:12px; color:#555;">Haut</label>
                            <input id="gapTopInput" type="number" min="0" step="1" value="20" class="kyo-input" style="width:80px; height:26px;">
                            <label for="gapRightInput" style="font-size:12px; color:#555;">Droite</label>
                            <input id="gapRightInput" type="number" min="0" step="1" value="20" class="kyo-input" style="width:80px; height:26px;">
                            <label for="gapBottomInput" style="font-size:12px; color:#555;">Bas</label>
                            <input id="gapBottomInput" type="number" min="0" step="1" value="20" class="kyo-input" style="width:80px; height:26px;">
                            <label for="gapLeftInput" style="font-size:12px; color:#555;">Gauche</label>
                            <input id="gapLeftInput" type="number" min="0" step="1" value="20" class="kyo-input" style="width:80px; height:26px;">
                        </div>
                        <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:10px;">
                            <button id="applyGapBtn" class="image-tool" style="padding:6px 10px;">Appliquer</button>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            <div class="toolbar-divider"></div>
            <div class="toolbar-section">
                <button class="image-tool" id="resetImageBtn"><i class="fas fa-undo"></i> Réinitialiser</button>
                <button class="image-tool" id="deleteImageBtn" style="background-color: #dc3545;"><i class="fas fa-trash"></i> Supprimer</button>
            </div>
            </div> <!-- /.image-tools-row -->
            <!-- Second line: proportions toggle -->
            <div class="toolbar-section" id="aspectRatioRow" style="flex-basis:100%; display:flex; align-items:center; gap:8px; margin-top:4px;">
                <div class="aspect-ratio-toggle">
                    <input type="checkbox" id="keepAspectRatio" checked>
                    <label for="keepAspectRatio">Conserver les proportions</label>
                </div>
            </div>
        </div>
    </div>
    <div class="video-toolbar" id="videoToolbar" style="display: none;">
        <div class="video-tools">
            <div class="dropdown">
                <button class="toolbar-btn" id="videoSizeBtn" title="Taille de la vidéo"><i class="fas fa-expand-arrows-alt"></i></button>
                <div class="dropdown-content" id="videoSizeOptions" style="display: none;">
                    <button class="dropdown-item" data-size="25"><i class="fas fa-ruler-horizontal"></i> 25%</button>
                    <button class="dropdown-item" data-size="33"><i class="fas fa-ruler-horizontal"></i> 33%</button>
                    <button class="dropdown-item" data-size="50"><i class="fas fa-ruler-horizontal"></i> 50%</button>
                    <button class="dropdown-item" data-size="66"><i class="fas fa-ruler-horizontal"></i> 66%</button>
                    <button class="dropdown-item" data-size="75"><i class="fas fa-ruler-horizontal"></i> 75%</button>
                    <button class="dropdown-item" data-size="100"><i class="fas fa-ruler-horizontal"></i> 100%</button>
                    <button class="dropdown-item" data-size="auto"><i class="fas fa-ruler-horizontal"></i> Auto</button>
                </div>
            </div>
            <div class="toolbar-divider"></div>
            <button class="toolbar-btn" id="videoAlignLeftBtn" title="Aligner à gauche"><i class="fas fa-align-left"></i></button>
            <button class="toolbar-btn" id="videoAlignCenterBtn" title="Centrer"><i class="fas fa-align-center"></i></button>
            <button class="toolbar-btn" id="videoAlignRightBtn" title="Aligner à droite"><i class="fas fa-align-right"></i></button>
            <div class="toolbar-divider"></div>
            <button class="toolbar-btn" id="videoDeleteBtn" title="Supprimer la vidéo" style="color:#dc3545;"><i class="fas fa-trash"></i></button>
        </div>
    </div>
    <div class="section-toolbar" id="sectionToolbar" style="display: none;">
        <div class="section-tools">
            <button class="toolbar-btn" id="sectionMoveUpBtn" title="Déplacer vers le haut"><i class="fas fa-arrow-up"></i></button>
            <button class="toolbar-btn" id="sectionMoveDownBtn" title="Déplacer vers le bas"><i class="fas fa-arrow-down"></i></button>
            <div class="toolbar-divider"></div>
            <div class="toolbar-section">
                <div class="dropdown">
                    <button class="toolbar-btn" id="sectionWidthBtn" title="Largeur de la section"><i class="fas fa-expand-arrows-alt"></i></button>
                    <div class="dropdown-content" id="sectionWidthOptions" style="display: none;">
                        <button class="dropdown-item" data-size="25"><i class="fas fa-ruler-horizontal"></i> 25%</button>
                        <button class="dropdown-item" data-size="33"><i class="fas fa-ruler-horizontal"></i> 33%</button>
                        <button class="dropdown-item" data-size="50"><i class="fas fa-ruler-horizontal"></i> 50%</button>
                        <button class="dropdown-item" data-size="66"><i class="fas fa-ruler-horizontal"></i> 66%</button>
                        <button class="dropdown-item" data-size="75"><i class="fas fa-ruler-horizontal"></i> 75%</button>
                        <button class="dropdown-item" data-size="100"><i class="fas fa-ruler-horizontal"></i> 100%</button>
                        <button class="dropdown-item" data-size="auto"><i class="fas fa-ruler-horizontal"></i> Auto</button>
                    </div>
                </div>
            </div>
            <div class="toolbar-divider"></div>
            <button class="toolbar-btn" id="sectionAlignLeftBtn" title="Aligner à gauche"><i class="fas fa-align-left"></i></button>
            <button class="toolbar-btn" id="sectionAlignCenterBtn" title="Centrer"><i class="fas fa-align-center"></i></button>
            <button class="toolbar-btn" id="sectionAlignRightBtn" title="Aligner à droite"><i class="fas fa-align-right"></i></button>
            <button class="toolbar-btn" id="sectionDeleteBtn" title="Supprimer la section" style="color:#dc3545;"><i class="fas fa-trash"></i></button>
            <div class="toolbar-divider"></div>
            <div class="dropdown">
                <button class="toolbar-btn" id="sectionBgColorDropdownBtn" title="Couleur de fond de la section">
                    <i class="fas fa-fill-drip" style="background-color: #ffffff;"></i>
                </button>
                <div class="dropdown-content color-dropdown" id="sectionBgColorDropdownContent" style="display: none;">
                    <div class="palette-heading">Couleurs principales</div>
                    <div class="color-palette primary" id="sectionBgPrimaryPalette">
                        <div class="palette-color" style="background-color: #000000;" data-color="#000000"></div>
                        <div class="palette-color" style="background-color: #FFFFFF;" data-color="#FFFFFF"></div>
                        <div class="palette-color" style="background-color: #6E3CBE;" data-color="#6E3CBE"></div>
                        <div class="palette-color" style="background-color: #0A9BCD;" data-color="#0A9BCD"></div>
                        <div class="palette-color" style="background-color: #F5B400;" data-color="#F5B400"></div>
                        <div class="palette-color" style="background-color: #F06400;" data-color="#F06400"></div>
                        <div class="palette-color" style="background-color: #00B176;" data-color="#00B176"></div>
                    </div>
                    <div class="palette-heading">Couleurs du thème</div>
                    <div class="color-palette" id="sectionBgColorPalette">
                        <div class="palette-color" style="background-color: #585858;" data-color="#585858"></div>
                        <div class="palette-color" style="background-color: #7E7E7E;" data-color="#7E7E7E"></div>
                        <div class="palette-color" style="background-color: #A9A9A9;" data-color="#A9A9A9"></div>
                        <div class="palette-color" style="background-color: #D4D4D4;" data-color="#D4D4D4"></div>
                        <div class="palette-color" style="background-color: #925ED2;" data-color="#925ED2"></div>
                        <div class="palette-color" style="background-color: #AE87DE;" data-color="#AE87DE"></div>
                        <div class="palette-color" style="background-color: #C9AFE9;" data-color="#C9AFE9"></div>
                        <div class="palette-color" style="background-color: #E4D7F4;" data-color="#E4D7F4"></div>
                        <div class="palette-color" style="background-color: #00B1DB;" data-color="#00B1DB"></div>
                        <div class="palette-color" style="background-color: #4AC5E5;" data-color="#4AC5E5"></div>
                        <div class="palette-color" style="background-color: #8DD9EE;" data-color="#8DD9EE"></div>
                        <div class="palette-color" style="background-color: #C7ECF6;" data-color="#C7ECF6"></div>
                        <div class="palette-color" style="background-color: #FFC200;" data-color="#FFC200"></div>
                        <div class="palette-color" style="background-color: #FFD14E;" data-color="#FFD14E"></div>
                        <div class="palette-color" style="background-color: #FFE18E;" data-color="#FFE18E"></div>
                        <div class="palette-color" style="background-color: #FFF0C8;" data-color="#FFF0C8"></div>
                        <div class="palette-color" style="background-color: #FF7C03;" data-color="#FF7C03"></div>
                        <div class="palette-color" style="background-color: #FF9E59;" data-color="#FF9E59"></div>
                        <div class="palette-color" style="background-color: #FFBF92;" data-color="#FFBF92"></div>
                        <div class="palette-color" style="background-color: #FFDFC9;" data-color="#FFDFC9"></div>
                        <div class="palette-color" style="background-color: #00C58D;" data-color="#00C58D"></div>
                        <div class="palette-color" style="background-color: #2FD3AB;" data-color="#2FD3AB"></div>
                        <div class="palette-color" style="background-color: #84E3C7;" data-color="#84E3C7"></div>
                        <div class="palette-color" style="background-color: #C4F0E3;" data-color="#C4F0E3"></div>
                    </div>
                </div>
            </div>
        </div>
        <script>
          (function(){
            const EDITABLE_ID = 'editableContent';
            function blobFromUrl(url) {
              return fetch(url).then(r => r.blob());
            }
            function resizeBlobIfNeeded(blob, mime) {
              return (async () => {
                try {
                  if (!/image\//i.test(mime)) return blob;
                  const img = await new Promise((res, rej) => {
                    const i = new Image();
                    i.onload = () => res(i);
                    i.onerror = rej;
                    i.src = URL.createObjectURL(blob);
                  });
                  const maxW = 1600;
                  const maxH = 1600;
                  let { width:w, height:h } = img;
                  if (w <= maxW && h <= maxH) return blob;
                  const ratio = Math.min(maxW / w, maxH / h);
                  const canvas = document.createElement('canvas');
                  canvas.width = Math.round(w * ratio);
                  canvas.height = Math.round(h * ratio);
                  const ctx = canvas.getContext('2d');
                  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                  const outMime = /png/i.test(mime) ? 'image/png' : 'image/jpeg';
                  const quality = /png/i.test(mime) ? 1.0 : 0.85;
                  const dataUrl = canvas.toDataURL(outMime, quality);
                  const bstr = atob(dataUrl.split(',')[1]);
                  let n = bstr.length; const u8 = new Uint8Array(n);
                  while(n--) u8[n] = bstr.charCodeAt(n);
                  return new Blob([u8], { type: outMime });
                } catch (_) {
                  return blob;
                }
              })();
            }
            function sanitizeBaseName(name) {
              try {
                const base = (name || '').split(/[\\\/]/).pop() || 'image';
                const noQuery = base.split('?')[0].split('#')[0];
                const parts = noQuery.split('.');
                const ext = parts.length > 1 ? ('.' + parts.pop()) : '';
                const stem = parts.join('.') || 'image';
                const safeStem = stem.replace(/[^a-zA-Z0-9_\-]/g, '').slice(0, 40) || 'image';
                return safeStem + ext;
              } catch { return 'image'; }
            }
            function extFromMime(mime) {
              try {
                if (!mime) return '.jpg';
                if (/png/i.test(mime)) return '.png';
                if (/webp/i.test(mime)) return '.webp';
                return '.jpg';
              } catch { return '.jpg'; }
            }
            async function uploadBlob(blob, suggestedName) {
              const fn = sanitizeBaseName(suggestedName);
              const fd = new FormData();
              fd.append('image', blob, fn || 'image');
              try { if (fn) fd.append('filename', fn); } catch (_) {}
              try { fd.append('overwrite', '1'); } catch (_) {}
              try {
                const res = await fetch('upload_image.php', { method: 'POST', body: fd });
                if (!res.ok) throw new Error('upload failed');
                const data = await res.json();
                if (!data || !data.success || !data.url) throw new Error('bad response');
                return data.url;
              } catch (e) {
                return '';
              }
            }
            function originalNameFromSrc(src) {
              try {
                if (!src) return '';
                if (/^\s*Image\//i.test(src)) {
                  const p = src.trim().split(/[?#]/)[0];
                  return p.split('/').pop() || '';
                }
                if (/^https?:/i.test(src)) {
                  const u = new URL(src);
                  return (u.pathname.split('/').pop() || '').split('?')[0].split('#')[0];
                }
                return '';
              } catch { return ''; }
            }
            async function processImgEl(img) {
              try {
                const src = img.getAttribute('src') || img.src || '';
                if (!src) return;
                if (/^\s*Image\//i.test(src)) return;
                const isData = /^data:/i.test(src);
                const isHttp = /^https?:/i.test(src);
                const isBlob = /^blob:/i.test(src);
                if (!isData && !isHttp && !isBlob) return;
                const guessedName = isHttp ? src : (img.getAttribute('alt') || 'image');
                let blob;
                if (isData) {
                  const m = src.match(/^data:([^;]+);base64,(.*)$/);
                  if (!m) return;
                  const mime = m[1];
                  const b64 = m[2];
                  const bin = atob(b64);
                  const arr = new Uint8Array(bin.length);
                  for (let i = 0; i < bin.length; i++) arr[i] = bin.charCodeAt(i);
                  blob = new Blob([arr], { type: mime });
                } else {
                  try { blob = await blobFromUrl(src); } catch { return; }
                }
                const resized = await resizeBlobIfNeeded(blob, blob.type || '');
                const preferName = originalNameFromSrc(src) || guessedName;
                const savedUrl = await uploadBlob(resized, preferName);
                if (savedUrl) {
                  img.src = savedUrl;
                  img.removeAttribute('srcset');
                  img.removeAttribute('sizes');
                }
              } catch (_) { }
            }
            const editable = document.getElementById(EDITABLE_ID) || document.body;
            const observer = new MutationObserver(muts => {
              for (const m of muts) {
                m.addedNodes && m.addedNodes.forEach(n => {
                  if (n.nodeType === 1) {
                    if (n.tagName === 'IMG') processImgEl(n);
                    n.querySelectorAll && n.querySelectorAll('img').forEach(processImgEl);
                  }
                });
              }
            });
            observer.observe(editable, { childList: true, subtree: true });
            editable.addEventListener('paste', () => {
              setTimeout(() => { editable.querySelectorAll('img').forEach(processImgEl); }, 0);
            });
            editable.addEventListener('drop', () => {
              setTimeout(() => { editable.querySelectorAll('img').forEach(processImgEl); }, 0);
            });
            async function exportZip() {
              const imgs = Array.from(document.querySelectorAll('#' + EDITABLE_ID + ' img'));
              let updated = 0, unchanged = 0, failed = 0;
              let counter = 1;
              for (const img of imgs) {
                try {
                  const src = img.getAttribute('src') || '';
                  if (!src) { unchanged++; continue; }
                  let blob;
                  if (/^data:/i.test(src)) {
                    const m = src.match(/^data:([^;]+);base64,(.*)$/);
                    if (!m) { unchanged++; continue; }
                    const mime = m[1];
                    const b64 = m[2];
                    const bin = atob(b64);
                    const arr = new Uint8Array(bin.length);
                    for (let i = 0; i < bin.length; i++) arr[i] = bin.charCodeAt(i);
                    blob = new Blob([arr], { type: mime });
                  } else {
                    try { blob = await blobFromUrl(src); } catch { failed++; continue; }
                  }
                  if (!blob) { failed++; continue; }
                  const resized = await resizeBlobIfNeeded(blob, blob.type || '');
                  const ext = extFromMime(resized.type || blob.type || '');
                  let fname = originalNameFromSrc(src);
                  if (!fname) {
                    const guessedName = img.getAttribute('alt') || 'image';
                    fname = sanitizeBaseName(guessedName) + '_' + String(counter).padStart(3, '0') + ext;
                  } else {
                    if (!/\.[A-Za-z0-9]+$/.test(fname)) fname = fname + ext;
                  }
                  const uploadedUrl = await uploadBlob(resized, fname);
                  if (uploadedUrl) {
                    img.src = uploadedUrl;
                    img.removeAttribute('srcset');
                    img.removeAttribute('sizes');
                    updated++;
                  } else {
                    failed++;
                  }
                  counter++;
                } catch (_) { failed++; }
              }
              alert(`Images traitées: ${updated} mise(s) à jour, ${unchanged} inchangée(s), ${failed} échec(s)`);
            }
            document.addEventListener('DOMContentLoaded', function () {
              const btn = document.getElementById('exportZipBtn');
              if (btn) btn.addEventListener('click', exportZip);
            });
          })();
        </script>
    </div>
    </div>

    <!-- History Modal (inline) -->
    <div id="historyModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.7); z-index: 10000; justify-content: center; align-items: center; padding: 20px; opacity: 0; transition: opacity 0.3s ease; pointer-events: none;">
      <div class="history-modal" style="background: white; border-radius: 8px; width: 90%; max-width: 1000px; max-height: 90vh; display: flex; flex-direction: column; position: relative; box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3); margin: 0; padding: 0; opacity: 0; transform: translateY(-20px); transition: opacity 0.3s ease, transform 0.3s ease; overflow: hidden;">
        <div class="modal-header">
          <h2 id="historyModalTitle">Historique des travaux</h2>
          <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="historySearch" placeholder="Rechercher..." class="search-input">
          </div>
          <button class="close" id="closeHistoryModal" aria-label="Fermer">&times;</button>
        </div>
        <div class="history-list-container" style="flex: 1; overflow-y: auto; padding: 0 20px 20px;">
          <div class="history-list" id="historyList" role="listbox" aria-multiselectable="true" style="margin: 0; padding: 0; list-style: none;"></div>
        </div>
        <div class="modal-footer">
          <div class="selection-info" id="selectionInfo">
            <span id="selectedCount">0</span> élément(s) sélectionné(s)
          </div>
          <div class="action-buttons">
            <button class="btn btn-primary" id="saveSnapshotBtn">Sauvegarder l'instantané</button>
            <button class="btn btn-outline" id="selectAllFooterBtn">Tout sélectionner</button>
            <button class="btn btn-outline" id="deselectAllFooterBtn">Tout désélectionner</button>
            <button class="btn btn-outline" id="cancelHistoryBtn">Annuler</button>
            <button class="btn btn-primary" id="previewHistoryBtn">Aperçu</button>
            <button class="btn btn-danger" id="deleteHistoryBtn">Supprimer</button>
          </div>
        </div>
      </div>
    </div>

    <div id="editorStatus" style="display:none">
      <span id="lastUpdate"></span>
    </div>

    <!-- Editor initialization flags (from original editor page) -->
    <script>
      window.__useInlineHistoryModal = true;
      window.__disableVideoPoster = true;
    </script>
    <!-- Core editor scripts -->
    <script src="editor.js"></script>
    <script src="history.js"></script>
    <!-- Client-side export dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        try {
          if (window.Editor && typeof Editor.normalizeLocalVideoSourcesOnLoad === 'function') {
            Editor.normalizeLocalVideoSourcesOnLoad();
          }
        } catch (e) { /* no-op */ }
      });
    </script>

    </body>
    </html>
